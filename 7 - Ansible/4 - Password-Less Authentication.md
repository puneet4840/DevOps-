# Password-Less Authentication in Ansible

Password-less authentication in ansible is the ability of control node (the system running Ansible) to connect to managed node (target systems) without requiring a password to each connection.

Instead of typing passwords, authentication is achieved using **SSH keys** or other mechanisms that don’t require manual input.

<br>

## Why Do We Need Password-less Authentication in Ansible?

- **Automation**:
  
  - Ansible is designed for automation. If the control node requires a password for each connection, automation is interrupted, as human intervention is needed to enter the password.

- **Scalability**:

  - In environments where Ansible manages hundreds or thousands of nodes, manually entering passwords is impractical.
 
- **Security**:

  - Password-less authentication (via SSH keys) eliminates the need to store passwords in plain text or share them across multiple systems.

- **Efficiency**:

  - Password-less authentication is faster than entering passwords manually for each connection, reducing deployment and configuration times.

<br>

## How Password-less Authentication Works in Ansible

Ansible uses **SSH keys** to establish secure, password-less connections between the control node and the managed nodes.

### What are SSH Keys?

- **SSH Key Pair**: A pair of cryptographic keys used for authentication:
  - **Private Key**: Stays securely on the control node.
  - **Public Key**: Shared with the managed nodes.

The private key is used to authenticate access to systems that have the corresponding public key.

<br>

## The Authentication Process

To understand how Ansible connects to managed nodes using **password-less authentication**.

- ### Key Generation on the Control Node

  - Imagine the control node (your main computer running Ansible) wants to securely connect to other computers (called managed nodes).
  - To do this, it creates a special "key pair":
    - **Private Key**: This is like a secret key that stays on your control node. You must keep it safe and never share it with anyone.
    - **Public Key**: This is like a lock that you can share with the managed nodes. Anyone with this lock can trust messages that are "opened" with your private key.

  - The key pair is created using a tool like ```ssh-keygen```, and you get two files:
    - ```id_rsa``` (private key, secret).
    - ```id_rsa.pub``` (public key, shareable).

- ### Sharing the Public Key with Managed Nodes

  - The next step is to send your **public key** (the lock) to the managed nodes.
  - On each managed node, this public key is added to a special file called ```~/.ssh/authorized_keys```.
    - Think of this file as a guest list—anyone with a key listed here is allowed to enter without a password.

  - For example, you can use the ssh-copy-id command to easily send your public key to the managed node:

    ```
    ssh-copy-id user@managed-node
    ```

    Now, the managed node knows to trust your control node.


- ### Establishing an SSH Connection

  When you use Ansible (or any SSH client) to connect to the managed node, this is what happens behind the scenes:

  **Step 1: Control Node Sends Its Public Key**

  - During the connection process, the control node introduces itself to the managed node by saying, "Here is my public key. Do you recognize it?"
 
  **Step 2: Managed Node Checks the Key**

  - The managed node looks in its ```~/.ssh/authorized_keys``` file. If the public key is found in the list, it proceeds to authenticate the connection.
  - If the public key is not found, the connection is rejected immediately.

  **Step 3: Challenge-Response Process**

  - To verify the control node’s identity, the managed node generates a random challenge (a string of random bytes).
  - The challenge is encrypted using the control node’s public key.
  - The managed node encrypts this challenge using the public key of the control node and sends it back.

  **Step 4: Control Node Proves Its Identity**

  - The control node receives the encrypted challenge.
  - Using its private key, the control node decrypts the challenge to retrieve the original random bytes generated by the managed node.
  - The control node sends the decrypted challenge back to the managed node.
 
  **Step 5: Managed Node Grants Access**

  - The managed node compares the decrypted challenge received from the control node with the original challenge it had generated.
    - If the two values match, the managed node confirms that the control node possesses the correct private key.
    - Authentication is successful, and the managed node grants access.
    - If the values do not match, authentication fails, and the connection is denied.

- ### Password-less Automation

  - Once the public key is set up on the managed nodes, the control node can connect to them without needing a password.
  - This means you can run Ansible playbooks and commands on multiple nodes seamlessly without manually entering passwords for each connection.

### Why is This Process Secure?

- **The Private Key is Never Shared**: Only the public key is shared, so no one can impersonate the control node without the private key.
- **The Challenge is Random**: Even if someone intercepts the communication, the challenge changes every time, so they cannot reuse old data.
- **Encryption Protects Data**: All communication is encrypted, ensuring that sensitive data stays secure.
- The public key is used for encryption (securing the challenge).
- The private key is used for decryption (proving identity).

<br>
<br>

## Steps to Set Up Password-less Authentication in Ansible

- ### Step 1: Generate an SSH Key Pair on the Control Node

  - Open a terminal on the control node.
  - Generate the SSH key pair:

    ```
    ssh-keygen -t rsa -b 2048
    ```

    - Options:

      - ```-t rsa```: Specifies the RSA algorithm.
      - ```-b 2048```: Sets the key size to 2048 bits.

    - You’ll be prompted to specify a file to save the key pair. Press ```Enter``` to use the default location (```~/.ssh/id_rsa```).
    - You’ll also be prompted to set a passphrase. You can skip this for fully automated processes, but using a passphrase is more secure.

- ### Step 2: Copy the Public Key to Managed Nodes

  The public key needs to be placed on all the managed nodes so the control node can authenticate without a password.
  
  - Use the ssh-copy-id command:

    ```
    ssh-copy-id user@managed-node-ip
    ```

    - Replace ```user``` with the username on the managed node.
    - Replace ```managed-node-ip``` with the IP address or hostname of the managed node.

  - Enter the password of the managed node when prompted.
  - Repeat this process for all managed nodes.
 
  Alternatively, manually append the public key to the managed node:

  - Copy the public key from the control node:

    ```
    cat ~/.ssh/id_rsa.pub
    ```

  - On the managed node, add the public key to the ```~/.ssh/authorized_keys``` file:

    ```
    echo "public_key_contents" >> ~/.ssh/authorized_keys
    ```

    Replace ```public_key_contents``` with the actual public key.

- ### Step 3: Test the Connection

  Verify that the control node can connect to the managed node without a password:

  ```
  ssh user@managed-node-ip
  ```

  You should be logged in without being prompted for a password.


Password-less authentication is a foundational step in setting up Ansible for efficient, secure, and scalable IT automation. By using SSH keys, Ansible ensures smooth communication between the control node and managed nodes, enabling seamless execution of tasks. This approach not only simplifies processes but also enhances the overall security of the system.
