# Roles in Ansible

Ansible **roles** are a way to organize your playbook into reusable and modular components. Instead of writing all the tasks in one place, you split them into smaller, reusable pieces called roles. Each role is responsible for a specific job.

Roles break your playbook into multiple files.

```Suppose हमको एक server पर ansible के through बहुत सारे packages install करने हैं और हमने एक playbook बना ली अब उस playbook के अंदर हमने suppose 50 tasks लिख दिए अथवा और भी चीज़े|```

```जैसे handlers, variables, etc. अगर हम इस playbook को देखे तो ये playbook बहुत lengthy हो जाएगी और playbook मैं इतनी सारी चीज़े होने की वजह से हमको playbook को समझने मैं भी problem होगी|```

```तो यहाँ concept आता है ansible roles का, ansible roles क्या करते हैं की एक playbook को अलग-अलग folders के अंदर YAML files मैं define कर देते हैं जैसे Hosts के लिए अलग YAML file बनाई और उसमे hosts लिखे दिए, Tasks के लिए अलग YAML file बनाकर उसमे tasks लिखे दिए, ऐसे ही सभी अलग-अलग components को अलग-अलग YAML files मैं define कर देते हैं मतलब playbook का एक अलग structure create करना इसी को ही roles कहते हैं|```

Roles in Ansible are a way to organize your playbooks and tasks into reusable and structured components.

Imagine this:
- You want to install and configure a web server (like Nginx).
- You also want to install a database (like MySQL).

If you put everything into one playbook, it will work, but as things grow more complex, managing everything becomes difficult. This is where roles come in—they help break down tasks into smaller, reusable, and well-organized pieces.

<br>

## Why Do We Need Roles?

Imagine you’re managing a large infrastructure with many servers, and you need to:
- Install a web server like Nginx or Apache.
- Configure a database like MySQL or PostgreSQL.
- Deploy an application.

If you write all these tasks in one big playbook: 
- The playbook becomes long and hard to manage. It also become hard to read and understand it.
- It’s difficult to reuse parts of the playbook in other projects.
- Debugging or updating the tasks becomes a headache.

Roles solve these problems by split the tasks into folders with specific purposes, such as:
- Tasks: What needs to be done (install Nginx, configure it, etc.).
- Variables: Custom settings like the Nginx version or port.
- Templates: Configuration files for Nginx.
- Files: Any static files (e.g., a default web page).
- Handlers: Special tasks that only run when triggered (e.g., restarting Nginx).

Here’s why roles are important:

- **Organization**: As your infrastructure grows, writing everything in one file becomes messy. Roles organize tasks, variables, and files neatly.
  
- **Reusability**: Roles can be reused across projects. For example, if you create a role to install and configure Nginx, you can use it in multiple projects.
  
- **Team Collaboration**: In a team, roles let everyone focus on specific parts of the project. For example, one team member handles the database role, while another handles the web server role.

- **Scalability**: Roles make it easier to manage large infrastructures by breaking them into manageable pieces.

- **Readability**: Roles are easy to understand and readable than complex playbooks.

<br>

## Structure of an Ansible Role

When you create a role (using ```ansible-galaxy init <role_name>```), the following directory structure is generated by default:

```
roles/
└── <role_name>/
    ├── tasks/          # Main tasks to be executed
    │   └── main.yml
    ├── handlers/       # Handlers triggered by tasks
    │   └── main.yml
    ├── files/          # Static files to be copied to the managed nodes
    ├── templates/      # Jinja2 templates
    ├── vars/           # Role-specific variables
    │   └── main.yml
    ├── defaults/       # Default variables for the role
    │   └── main.yml
    ├── meta/           # Role metadata (dependencies, author info)
    │   └── main.yml
    └── README.md       # Documentation for the role
```

### Components of Roles:

- **<role_name>**: This is the root directory for your role. It contains all the subdirectories and files that define the role's functionality.

- **tasks**: Contains YAML files (often main.yml) that define the core tasks your role will execute on the target machines. These tasks might involve installing software, configuring services, deploying applications, or managing files.
 
  Example:

  ```
  # tasks/main.yml
    - name: Install Nginx
      ansible.builtin.package:
        name: nginx
        state: present

    - name: Start Nginx service
      ansible.builtin.service:
        name: nginx
        state: started
        enabled: true
  ```

- **handlers**: Contains YAML files (often main.yml) that define handlers, which are special tasks that are only triggered when certain conditions are met. This helps to automate reactions to changes on the target systems.

  Example:
  ```
  - name: Restart Apache on package change
    service:
      name: apache2
      state: restarted
    when: ansible_os_family == "Debian"  # Run only on Debian-based systems
  ```

- **files**: Contains static files that you want to copy to the target machines during role execution. These might be configuration files, scripts, or any other files needed for your tasks.

- **templates**: Contains Jinja2 templates, which are dynamic templates that can be used to generate configuration files based on variables. This allows for more flexible and reusable configurations.

  Example:
  ```
  # Configuration for the Nginx web server
  server {
      listen 80;
      server_name {{ web_server_hostname }};

      location / {
          root /var/www/html;
          index index.html index.htm;
      }
  }
  ```

- **vars**: Contains YAML files (often main.yml) that define role-specific variables, which can be used within tasks, handlers, and templates. These variables provide customization options for the role's behavior. Contains variables with higher precedence than ```defaults/```.
  - ```main.yml``` defines these variables.

- **defaults**:
  - Contains YAML files (often ```main.yml```) that define default variables for the role. These defaults can be overridden by user-defined variables when the role is included in a playbook. This allows for flexible configuration while providing sensible defaults. If you are not providing anu values in the vars then default value for that variable will be picked from defaults.

- **meta**: Contains YAML files (often main.yml) that define role metadata, such as dependencies on other roles, author information, and license details. This metadata provides important information about the role and how to use it effectively.

<br>

## What is Ansible Galaxy?

Ansible Galaxy is the platform where you can share your roles, download roles.

```Suppose आपको virtual machines का use करके Kubernetes Cluster create करना है तो उसको आप Ansible से create कर सकते हो| Ansible Galaxy से pre-build roles को download करके आप अपना kuberentes clsuter setup कर सकते हैं|```

Ansible Galaxy is a community platform provided by Ansible where you can **discover**, **download**, **share**, and **manage** **roles** and **collections**. It serves as a central repository where:

- Developers and organizations share their pre-built Ansible content (roles and collections).
- Users can find reusable roles and collections to automate their tasks without starting from scratch.

It’s like an app store, but for Ansible automation content. Galaxy reduces the effort needed to create everything from scratch and promotes community collaboration.

Ansible Galaxy is the primary way to distribute and consume Ansible roles. Roles are the content that Galaxy hosts and manages.

### Key Features of Ansible Galaxy

- **Role Sharing**:

  - Developers can create roles for specific tasks and share them on Galaxy.
  - Other users can download and use these roles directly in their projects.
 
- **Collections**:

  - Collections are bundles of Ansible roles, modules, plugins, and playbooks.
  - They group related automation content into one package.
 
- **Search and Discovery**:

  - You can search for roles or collections based on functionality, such as "installing Nginx" or "managing AWS resources."

- **CLI Integration**:

  - The ```ansible-galaxy``` command-line tool allows you to interact with Galaxy directly to download, install, and manage roles and collections.

### How Is It Related to Roles?

Ansible Galaxy and roles are closely connected because roles are the building blocks of reusable Ansible content. Galaxy is primarily a hub for sharing and obtaining these roles.

- Developers use ```ansible-galaxy``` init to create a new role with the standard directory structure.
- Once developed, they can share it on Ansible Galaxy.
- You can download roles from Galaxy and use them in your playbooks without writing everything from scratch.
