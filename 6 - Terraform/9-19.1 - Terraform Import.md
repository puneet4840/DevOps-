# Terraform Import

Terraform ek Infrastructure as Code (IaC) tool hai jisme tum code likhkar apne cloud ka infrastructure create, update aur destroy karte ho.

Lekin real life mein bahut baar hota hai ki resources already cloud par bana hua hai. “Agar mera resource pehle se hi cloud me bana hua hai, lekin maine uska Terraform code nahi likha, to main terraform ko kaise bolun ki ye resource mera hi hai?”

Yaha kaam aata hai ```terraform import```.

Terraform import, cloud mein pehle se bane hue resources ko terraform state file mein register karne ka kaam karta hai, jisse terraform ko ye lage ki ye resource jo pehle se bane hue hain ye bhi terraform hi manage kar rha hai.

Suppose:

Terraform normally tabhi resources manage karta hai jo usne khud banaye hain. Matlab jab tum ```terraform apply``` karte ho tab wo resources create hote hain aur Terraform ke paas unka record (state file mein) hota hai.

Lekin real life mein bahut baar hota hai ki resources already bana hua hai – kisi ne manually Azure console se VM bana di, ya purane project mein ARM se bana tha, ya team ke kisi aur member ne direct CLI se create kar diya.

Ab tum chahte ho ki aage se ye saare resources bhi Terraform se manage hon (version control mein hon, consistent rahein, drift detect ho etc).

Toh un existing resources ko Terraform ke state mein "ghusane" (register karne) ka command hai → ```terraform import```.

<br>
<br>

### Terraform Import Kya Hai?

**Terraform import** ek command hai jo Terraform ko bolta hai:
- “Ye resource jo cloud me already bana hua hai, isko Terraform ke state file me register kar lo."

Matlab:
- Resource cloud me already exist karta hai.
- Lekin Terraform ko nahi pata ye resource kaha se aaya.
- Tum Terraform ko import karke bata sakte ho ki ye wala AWS/Azure/GCP resource ab se Terraform ke under aayega.
- Ye sirf state file me entry banata hai.
- Code (configuration .tf file) tumhe manually likhna padta hai.

Ye command sirf terraform.tfstate file mein un resource ki entry bana deta hai, lekin resource tf file hoti hain vo tumko manually likhni padti hain.

<br>
<br>

### Terraform Import Ki Zarurat Kyu Padti Hai?

Bahut reasons hote hain:

**1. Existing Infrastructure Already Bana Hua Hai**:
- Jaise tumhari company ne Azure me manually VM instance bana diya hua hai.
- Ab tum chahte ho:
  - usko Terraform manage kare,
  - changes code se hon,
  - version control me aaye.
 
**2. Kisi Resource Ka Tfstate Delete Ya Corrupt Ho Gaya**:
- Agar accidentally tfstate file delete ho jaaye, lekin resource cloud me survive karta rahe → import ka use hota hai.

**3. Old Setup Ko Terraform Me Migrate Karna**:
- “Acha, yeh purana cluster manually banaya tha, ab ise IaC me convert karna hai.”

**4. Multi-Team Environment**:
- Ek team resource banati hai manually, tum use IaC me lana chahte ho.

<br>
<br>

### Terraform Import: Internal Deep Job

Terraform import internally yeh steps karta hai:
- Provider ke API ko call karta hai (AWS/Azure/GCP) → Resource ka live state fetch karta hai.
- State file me resource ka JSON object add karta hai.
- Resource address (aws_instance.myserver) ko resource real ID (i-xxxxx) se link karta hai.
- Configuration aur live resource me jo differences hai → Terraform future plan me compare karega.

<br>
<br>

### Example — Azure Storage Account Ko Terraform Me Import Karna

**Step 1: Azure Storage Account Pehle Se Bana Hua Hai**:
- Maan lo Azure pe ek storage account bana hua hai:

<br>

**Step 2: Terraform Directory Banao**:
```
mkdir import-demo
cd import-demo
```

<br>

**Step 3: provider aur resource block banao**:

```main.tf``` me likho:
```
provider "azurerm" {
  features {}
}

resource "azurerm_storage_account" "sa" {
  # empty block - required for import
}
```

<br>

**Step 4: Init karo**:
```
terraform init
```

<br>

**Step 5: Azure Portal se Resource ID copy karo**:

Azure Portal → Storage Account → Properties → Resource ID
```
/subscriptions/84f8dabc-22ff-4c20-9c99-8123bae23aae/resourceGroups/rg-demo/providers/Microsoft.Storage/storageAccounts/punittestsa
```

<br>

**Step 6: Import command chalao**:
```
terraform import azurerm_storage_account.sa /subscriptions/84f8dabc-22ff-4c20-9c99-8123bae23aae/resourceGroups/rg- emo/providers/Microsoft.Storage/storageAccounts/punittestsa
```
Output:
- Resource state file me aa jayega.
- ```.tfstate``` me iski poori JSON entry create ho jayegi.

<br>

**Step 7: Ab terraform plan karo**:
```
terraform plan
```
Output:
- Terraform bolega “bohot saare fields match nahi kar rahe”.
- Kyuki tumne .tf file me values nahi dali.

<br>

**Step-8: Terraform Show command chalao**:

Ab tum ```terraform show``` command chalao, is command se resource ki saaro configuration tumko json format mein mil jayegi.

```Terraform show``` command cloud pe bane hue resources ki information json form mein dikhata hai.

Tum yaha se resource ki information leke terraform script resources mein likh sakte ho.

Agar koi error aata hai to tum manually error ke hisab se kuch kuch configuration delete karke terraform plan chalke **No Changes** tak le jao.

**No Changes ka Matlab**:

No changes ka matlab hai ki ```terraform plan``` chalane par terraform cloud par kuch change na kare.

<br>

**"No Changes" laane ka sahi tarika**:

```terraform show``` command se copy karne par bahut saari aisi cheezein aa jati hain jo Terraform ko nahi chahiye hoti (Computed values).

Step-by-step Clean up:
- Computed Fields Hatayein: Jo fields Azure khud manage karta hai (jaise id, default_hostname, outbound_ip_addresses), unhe .tf file se delete kar dein.
- Null Fields Hatayein: Agar kisi field ki value null ya [] (empty list) dikh rahi hai, to use bhi hata dein.

<br>

**Step 9: Ab fir se plan karo**:
```
terraform plan
```

Agar sab values exact match ho gayi → Terraform bolega: **“No changes”**.


<br>
<br>

### Most Important Point — Shuruati Developers Ye Galti Karte Hain

- Import automatically .tf configuration file create nahi karta.
- Ye sirf state file generate karta hai ya fir usme entry karta hai.

Matlab state file ko resource ka “actual reality” pata chal jati hai.

Tumko manually ye ensure karna hota hai:
- Tumhare .tf code ka configuration.
- Imported resource ke actual cloud configuration se match ho.

Agar match nahi karega → plan me drift dikhega

Terraform bolega: “Ye setting match nahi ho rahi, mai change kar doon?” 

<br>
<br>

### Best Practices — Very Important

**Always document imported resources**:

Imported resources ko hamesha document ed rakho.

Comment likho:
```
# Imported manually from existing resource
```

**Pehle terraform plan check karo**:
- Taaki terraform ko galat config dekar destroy na karwa do.

**State file ka backup rakho**:
- Import se pehle backup zaruri hai.

**Import ke baad full resource block likho**:
- Drift avoid hoga.

