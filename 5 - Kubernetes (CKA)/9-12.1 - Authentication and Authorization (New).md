# Authentication and Authorization in Kubernetes

Kubernetes me koi bhi user, script, kubectl command, ya API call, agar cluster ke andar koi kaam karna chahta hai — jaise Pod create karna, secret dekhna, ya logs read karna. To ye request API Server par aati hai, to api server is request ko **Authenticate**, **Authorize** aur **Validate (Admission Control)** karta hai.

- **Authentication**: (Tum kaun ho? – Identity verification).
- **Authorization**: (Tumko ye kaam karne ka permission hai ya nahi?).
- **Validation (Admission Control)**: Request allow hone ke baad kya aur checks lagne chahiye?

Jab request api server par aati hai, api server is request ko authenticate, authorize aur validate karta hai, ye hi concept hota hai authentication aur autorization.

<br>

### 1 - Authentication (Tum kaun ho?)

Authentication ka kaam hai user ki identity verify karna.

**Main Point**: Kubernetes apna user store maintain nahi karta jaise ki ek normal web app ka DB hota hai. Iske instead, ye external identity sources pe depend karta hai ya phir certificates, tokens, etc. ke through identity proof le leta hai.

**Authentication Flow**:
- User ya system component API Server ko request bhejta hai.
- Request ke saath kuch credential hota hai — jaise:
  - Certificate.
  - Token.
  - Username + Password (basic auth).
 
- API Server request ka header dekh ke decide karta hai ki is request ko authenticate karne ke liye kaunsa authenticator use karna hai.
  - Jaise:
    - Static Token File.
    - X.509 Client Certificates.
    - Service Account Tokens (Pods ke liye).
    - OpenID Connect (OIDC).
    - Webhook Token Authentication.
    - Proxy Authentication.
  - API server har incoming request ko sequentially har authenticator se verify karta hai jab tak match na mil jaye.
 
- Agar authentication pass ho gaya → request **Authorization** step me jaayegi, warna 401 Unauthorized, aur request reject ho jayegi.

**Types of Kubernetes Authentication**:

**Static Token File**:
- Tum ek CSV file bana ke API Server ko dete ho jisme har user ka token likha hota hai.

Example:
```
token,user,uid,"group1,group2"
abc123,Puneet,1001,dev-team
```
- API Server start karte waqt flag dete ho.
- Ye method simple hai lekin production me insecure hai kyunki tokens static hai aur manually rotate karne padte hain, testing purpose ke liye thik hai.

<br>

**X.509 Client Certificates**:
- Har user ke paas ek client certificate hota hai jo trusted CA se signed hai.
- Jab tum kubectl se request bhejte ho to TLS handshake ke time API Server tumhara certificate verify karta hai.

Example:
```
kubectl --client-certificate=user.crt --client-key=user.key get pods
```
- Secure aur production me common.

Below is the complete overview.


<br>

**Service Account Tokens (Pods ke liye)**:
- Jab ek Pod ko cluster API access karna hota hai to pod usko service account ke thorugh hota hai to pod ko ek service account assign hota hai.

Example:
- Pod me chal rahi app ko apne namespace ke ConfigMap padhna hai.

- Service account ka token Pod ke andar ```/var/run/secrets/kubernetes.io/serviceaccount/token``` me mount hota hai.
- API Server is token ko verify karta hai.

<br>

**OpenID Connect (OIDC)**:
- Tum external Identity Provider (IDP) use karte ho jaise Google, Azure AD, Okta, etc.
- OIDC me JWT token aata hai jo API Server verify karta hai.
- Ye enterprise me single sign-on (SSO) ke liye best hota hai.

<br>

**Webhook Token Authentication**:
- Tum apna custom auth service likh sakte ho jo API Server se token verify karega.
- API Server webhook ko call karke response leta hai (pass/fail).

<br>

**Proxy Authentication**:
- Tum API Server ke aage ek reverse proxy laga ke auth kara sakte ho (jaise NGINX, Apache).
- Proxy authenticated user ka naam HTTP header me API Server ko pass karta hai.

<br>

**Note**:
- Ek hi API Server me multiple authenticators enable ho sakte hain.
- Har incoming request sequentially har authenticator se verify hoti hai jab tak match na mil jaye.

<br>
<br>

### 2 - Authorization (Tumko ye kaam karne ka right hai ya nahi?)

Authentication ke baad jab API Server ko pata chal gaya ki tum kaun ho, tab wo check karega ki tum jo kaam kar rahe ho uska permission hai ya nahi.

Authorization ka kaam hota hai permissions check karna.

**Authorization Flow**:
- API Server tumhari request ke details dekhta hai:
  - User ka naam.
  - User ke groups.
  - Resource (pods, deployments, secrets, etc.).
  - Namespace.
  - Action (get, list, create, delete, patch…).
 
- Authorization module me rules check hota hai.
- 
