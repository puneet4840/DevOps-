# RBAC in Kubernetes

RBAC -> Role Based Access Control

RBAC ka full form hai: **Role-Based Access Control**.

Iska kaam hai:
- Define karna ki kon (user, group, service account),
- kis resource par (pods, deployments, services, secrets, etc.),
- kya action (verbs: get, list, create, update, delete, watch),
- perform kar sakta hai ya nahi.

RBAC kubernetes ka security mechanism hota hai jo user, group ya service account ko kubernetes ke resources jaise pods, deployment, services, etc par permission provide karta hai. Permission ka matlab hai kya user, group ya service account kubernetes ke resources ko access kar sakta hai ya nhi.

<br>

### RBAC Kubernetes main kab use hota hai.

Kubernetes main jab user ya service account, kubernetes ke kisi bhi resource ko access karte hain to Api Server ko request send karte hain, Api Server ke paas request aane ke baad Api Server 3 task perform karta hai, Jaise:
- Authentication.
- Authorization.
- Validation.

Ye jo Authorization part hota hai, Yha pe RBAC ka part aata hai. Is Authorization task main Api Server RBAC ke through jo request Api Server par aayi hai uski permission check karta hai.

<br>

### RBAC ki zaroorat kyon padi?

Kubernetes ek multi-user system hai. Matlab cluster me ek hi time par multiple log (admins, developers, testers, CI/CD pipelines, monitoring tools) kaam kar rahe hote hain.

Agar hum sochen ki har kisi ko cluster-admin access de diya jaye to:
- Developer galti se ```kubectl delete pod --all -n production``` chala de → ```production crash```.
- Intern sirf pod dekhna chahata tha, par uske paas delete karne ka bhi access hai → ```risk```.
- Jenkins pipeline ko sirf apne namespace me deploy karna hai, par uske paas secrets dekhne ka bhi access aa gaya → ```security issue```.
- Company me compliance requirements hoti hain (ISO, SOC2, HIPAA) jo kehti hain ki ```“least privilege principle”``` follow karo → har user ko sirf utna access do jitna zaroori hai.

Isliye Kubernetes ne ek authorization mechanism banaya jisme tum define kar sako:
- Kaun (Subject: User, Group, ServiceAccount).
- Kis resource pe (pods, deployments, nodes, secrets, namespaces, PVs).
- Kaunsa action kar sakta hai (get, list, watch, create, update, delete, patch, exec)

Aur isi ka naam hai RBAC (Role-Based Access Control).

<br>

### Authorization ke Liye RBAC kyu aaya?

Pehle Kubernetes mein access control ke liye basic ABAC (Attribute-Based Access Control) hota tha jisme ek JSON policy file hoti thi jisme likha hota tha ki kaun kya kar sakta hai matlab kisko kya permission hai.

Problem:
- Har baar JSON file edit karni padti thi.
- Dynamic changes possible nahi the.
- Large clusters mein bahut complex ho jata tha.

Isliye Kubernetes ne introduce kiya: **RBAC (Role-Based Access Control)**.

<br>

### RBAC ka Concept

RBAC ka concept simple hai:
- Instead of directly binding permissions to users,groups or service accounts, tum permissions ko roles mein define karte ho. Fir users ya groups ko roles assign karte ho.
- Pehle tum ek role create karoge.
- Fir us role ko user, groups ya service account se bind karne ke liye ek role binding create karoge.
- RoleBinding se role main jo defined permissions hongi vo user, group ya service account ko attach ho jayengi.

Matlab ek 4 step ka system hai:
- **User / ServiceAccount** (koi entity jo cluster use karna chahti hai).\
- **Role** ya **ClusterRole** (ek permission set jo allow karta hai ki kya actions perform kar sakte ho).
- **RoleBinding** ya **ClusterRoleBinding** (ek mapping jo user ko ek role ke sath jodta hai).
- **Kubernetes API Server** (ye har request pe check karega ki user ke paas wo permission hai ya nahi).

<br>

### Components in RBAC

RBAC main 4 components hote hain:

**Role**:
- Role ek permission set hota hai jo sirf particular namespace main permission provide karta hai.
- Iska matlab ki role user, service account ko sirf ek namesapce main hi permission provide karega. Agar sabhi namespace main permission deni hai to ClusterRole create karna padta hai.

Example: Ek role jo sirf ```pods``` aur ```deployments``` read karne ki permission deta hai.
```
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  namespace: dev-team
  name: pod-reader
rules:
- apiGroups: [""] # "" = core API group
  resources: ["pods", "deployments"]
  verbs: ["get", "list", "watch"]
```

Explanation of Role:
- ```apiVersion: rbac.authorization.k8s.io/v1```:
  - ```rbac.authorization.k8s.io``` = RBAC related resources ke liye Kubernetes ka API group.
  - ```v1``` = stable version hai.

- ```kind: Role```:
  - ```kind``` hamesha batata hai ki tum kis type ka resource bana rahe ho.
  - Yaha ```Role``` likhne ka matlab hai ki tum ek namespace-scoped RBAC role bana rahe ho.
 
- ```metadata```:
  - Har Kubernetes object ke sath ek ```metadata``` section hota hai jisme naam, namespace, labels, annotations define hote hain.
  - Ek tarah se kubernetes object ki detail ko metadeta main likha jata hai jaise ki ye object kya krta hai.
  - ```namespace: dev-team```:
    - Ye role sirf ```dev-team``` namespace ke andar valid hai.
    - Agar Puneet kisi aur namespace mein pod access karega to ye role apply nahi hoga.
  - ```name: pod-reader```:
    - Ye is role ka unique naam hai.
    - Is naam se hum isko RoleBinding ke andar reference karenge.
   
- ```rules```:
  - Ye sabse important section hai — ye define karta hai ki is role ke paas kya-kya permissions hain.
  - Ek role ke andar ek ya multiple ```rules``` blocks ho sakte hain.
  - ```apiGroups: [""]```:
    - Kubernetes APIs different groups mein divided hain.
    - ```""``` (empty string) ka matlab hai core API group jisme pods, services, configmaps jaise resources aate hain.
    - Agar tum "apps" likhte to usme Deployments, DaemonSets aate.
    - Matlab: Ye batata hai ki tum kis API group ke resources pe rules apply kar rahe ho.
  - ```resources: ["pods", "deployments"]```:
    - Iska matlab hai is role ke paas pods aur deployments pe permission milegi.
    - Agar tum yaha ```"*"``` likh dete to iska matlab sabhi resources.
    - Matlab: Ye exact resources specify karta hai jinpe ye role kaam karega.
  - ```verbs: ["get", "list", "watch"]```:
    - Ye actual actions/operations define karta hai jo allow hain.
    - ```get``` → ek resource ki details dekhna.
    - ```list``` → ek saath multiple resources ki list nikalna.
    - ```watch``` → resource ke updates ko continuously dekhna (kubectl describe/logs jaise commands ke liye useful).
    - Agar yaha ```create```, ```delete``` bhi hota to wo aur zyada powerful role hota.
 

<br>

**ClusterRole**:
- ClusterRole ek permission set hai jo cluster wide permission dene ke liye responsible hota hai.
- Iska matlab hai ki ClusterRole user, group, service account ko kubernetes cluster ke ander sabhi resources par sabhi namespace ke ander permission provide karta hai.

Example: Monitoring tools ke liye cluster-wide read access dena.
```
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: cluster-read-all
rules:
- apiGroups: [""]
  resources: ["pods", "services", "nodes"]
  verbs: ["get", "list", "watch"]
```

Explanation of ClusterRole:
- ```apiVersion: rbac.authorization.k8s.io/v1```:
  - Ye batata hai ki hum RBAC API group ke under ek resource create kar rahe hain.
  - RBAC objects (Role, ClusterRole, RoleBinding, ClusterRoleBinding) sab isi API group ke under aate hain.
  - ```v1``` ka matlab hai stable production ready version.
- ```kind: ClusterRole```:
  - Ye define karta hai ki hum ek ClusterRole bana rahe hain.
- ```metadata```:
  - Ye section hamesha har Kubernetes object me hota hai. Ye basically object ki identity aur details ke liye hota hai.
  - ```name: cluster-read-all```:
    - Ye ClusterRole ka naam hai: ```cluster-read-all```.
    - Ye naam unique hona chahiye cluster ke andar.
    - Is naam se baad me ClusterRoleBinding me refer karenge.
- ```rules```:
  - Ye ClusterRole ke andar actual permissions hoti hain.
  - Ek ClusterRole me multiple rules ho sakte hain.
  - ```apiGroups: [""]```:
    - Ye batata hai ki ye rule kis API group ke resources pe apply hoga.
    - ```""``` (empty string) ka matlab hai core API group.
    - Core API group me pods, services, configmaps, secrets jaise resources hote hain.
  - ```resources: ["pods", "services", "nodes"]```:
    - Iska matlab hai is ClusterRole se pods, services, nodes pe permission milegi
  - ```verbs: ["get", "list", "watch"]```:
    - Ye actual actions/operations define karta hai jo allow hain.
    -  ```get``` → ek resource ki details dekhna.
    - ```list``` → ek saath multiple resources ki list nikalna.
    - ```watch``` → resource ke updates ko continuously dekhna (kubectl describe/logs jaise commands ke liye useful).


<br>

**RoleBinding**:
- Humne user ya service account ke liye ek permission set to create kar diya jisko hum role kehte hain, lekin us permission ko particular user ya service account ke saath attach bhi to karna padega, to ye kaam RoleBinding karta hai, RoleBinding user ya service account ko role ke saath attach karta hai jisse user ya service account ko permission mil sake jo tumne role main define ki hai.

- Ye ek user/serviceaccount ko ek Role ke sath bind karta hai ek namespace ke andar.

Example: Binding user puneet with a role 
```
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: read-pods
  namespace: dev-team
subjects:
- kind: User
  name: puneet
  apiGroup: rbac.authorization.k8s.io
roleRef:
  kind: Role
  name: pod-reader
  apiGroup: rbac.authorization.k8s.io
```
- Ab user ```puneet``` ke paas sirf ```dev-team``` namespace mein pods read karne ka access hoga.

Explanation of RoleBinding:
- ```apiVersion: rbac.authorization.k8s.io/v1```:
  - Ye batata hai ki hum RBAC ka object bana rahe hain aur RBAC ka API group "rbac.authorization.k8s.io" hai. Version v1 stable hai.
- ```kind: RoleBinding```:
  - Ye batata hai ki hum kaunsa resource/object create kar rahe hain. Yahaan hum RoleBinding bana rahe hain.
- ```metadata```:
  - Ye section hamesha har Kubernetes object me hota hai. Ye basically object ki identity aur details ke liye hota hai.
  - ```name: read-pods```:
    - Ye RoleBinding ka naam hai. Yahaan naam diya gaya hai: ```read-pods```.
  - ```namespace: dev-team```:
    - Ye batata hai ki ye RoleBinding kis namespace ke liye valid hai.
- ```subjects```:
  - Ye section batata hai ki kisko (user, group, ya service account) ye role assign kiya ja raha hai.
  - Subjects ek array hota hai, matlab multiple users/groups ko ek saath bhi bind kar sakte ho.
  - ```kind: User```:
    - Ye specify karta hai ki subject ka type kya hai. Yahaan ```User``` hai.
    - Aur kya options hote hain?
      - ```User``` → agar ek individual user ko access dena ho.
      - ```Group``` → agar ek group ke sabhi users ko access dena ho.
      - ```ServiceAccount``` → agar ek pod/application ke liye specific account ko access dena ho.
  - ```name: puneet```:
    - Ye us user ka naam hai jisko access milega.
    - Agar humne Kubernetes ke native certificate-based user banaya hota, to CN (Common Name) ke value ke hisaab se yaha name likhna hota.
    - Agar hum Azure AD integrated user hote, to Azure AD ka username ya UPN hota.
  - ```apiGroup: rbac.authorization.k8s.io```:
    - Ye batata hai ki subject kis API group ka part hai.
    - Ye ek formal requirement hai taaki Kubernetes ko confusion na ho. Yahaan hamare subjects RBAC API ke under manage hote hain, isiliye ```rbac.authorization.k8s.io```.
    - Agar subject ek core ServiceAccount hota (jo namespace ke andar hota hai), tab ye "" (empty string) hota.
- ```roleRef```:
  - Ye section batata hai ki kaunsa Role (ya ClusterRole) subject ko assign kiya ja raha hai.
  - RoleBinding ka kaam hi hai ek Role ko kisi subject ke saath bind karna.
  - ```kind: Role```:
    - Ye batata hai ki hum ek Role ko refer kar rahe hain, na ki ClusterRole. Kyuki RoleBinding Role ke liye use hota hai aur ClusterRoleBinding ClusterRole ke liye use hota hai isliye.
  - ```name: pod-reader```:
    - Ye us Role ka naam hai jisko hum link kar rahe hain.
  - ```apiGroup: rbac.authorization.k8s.io```:
    - Ye batata hai ki jo Role hum refer kar rahe hain, wo RBAC API group ka hai.
    - Ye mandatory field hai taaki Kubernetes ko confusion na ho ki hum kis API group ka Role refer kar rahe hain.


<br>

**ClusterRoleBinding**:
- Humne user ya service account ke liye ek permission set to create kar diya jisko hum ClusterRole kehte hain, lekin us permission ko particular user ya service account ke saath attach bhi to karna padega, to ye kaam ClusterRoleBinding karta hai, ClusterRoleBinding user ya service account ko ClusterRole ke saath attach karta hai jisse user ya service account ko permission mil sake jo tumne role main define ki hai.

- Ye ek user/serviceaccount ko ek ClusterRole ke sath bind karta hai poore cluster pe sabhi namespaces main sabhi resources ke liye.

Example:
```
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: cluster-read-access
subjects:
- kind: User
  name: puneet
  apiGroup: rbac.authorization.k8s.io
roleRef:
  kind: ClusterRole
  name: cluster-read-all
  apiGroup: rbac.authorization.k8s.io
```

Explanation of ClusterRoleBinding:
- ```apiVersion: rbac.authorization.k8s.io/v1```:
  - Ye batata hai ki hum RBAC API group ke under ek resource create kar rahe hain.
  - RBAC objects (Role, ClusterRole, RoleBinding, ClusterRoleBinding) sab isi API group ke under aate hain.
- ```kind: ClusterRoleBinding```:
  - Ye batata hai ki hum kaunsa resource/object create kar rahe hain. Yahaan hum ClusterRoleBinding bana rahe hain.
- ```metadata```:
  - Ye section hamesha har Kubernetes object me hota hai. Ye basically object ki identity aur details ke liye hota hai. Isme object ki detai jese object ka kya naam hai ye likha jata hai.
  - ```name: cluster-read-access```:
    - Ye ClusterRoleBinding ka naam hota hai jaise yaha naam diya gaya hai ```cluster-read-access```.
    - Ye ek unique identifier hai jo cluster ke andar is binding ko represent karega.
- ```subjects```:
  - Ye section batata hai ki kisko (user, group, ya service account) ye ClusterRole assign kiya ja raha hai.
  - Tum multiple subjects bhi define kar sakte ho ek hi ClusterRoleBinding ke andar.
  - ```kind: User```:
    - Ye specify karta hai ki subject ka type kya hai. Yahaan ```User``` hai.
    - Aur kya options hote hain?
      - ```User``` → agar ek individual user ko access dena ho.
      - ```Group``` → agar ek group ke sabhi users ko access dena ho.
      - ```ServiceAccount``` → agar ek pod/application ke liye specific account ko access dena ho.
  - ```name:puneet```:
    - Ye batata hai ki binding kis user ko assign ki ja rahi hai.
    - Yahan puneet ek user ka naam hai jo Kubernetes authentication system ke andar registered hoga (e.g. certificate, OIDC, etc.).
  - ```apiGroup: rbac.authorization.k8s.io```:
    - Ye batata hai ki subject kis API group ka part hai.
    - Ye ek formal requirement hai taaki Kubernetes ko confusion na ho. Yahaan hamare subjects RBAC API ke under manage hote hain, isiliye ```rbac.authorization.k8s.io```.
    - Agar subject ek service account hota, to yahan namespace bhi dena padta.
- ```roleRef```:
  - Ye section batata hai ki kaunsa (ClusterRole) subject ko assign kiya ja raha hai.
  - ```kind: ClusterRole```:
    - Ye batata hai ki hum ek ClusterRole ko refer kar rahe hain, na ki Role. Kyuki ClusterRoleBinding ClusterRole ke liye use hota hai.
  - ```name: cluster-read-all```:
    - Jo ClusterRole hum de rhe hain usna naam kya hai.
  - ```apiGroup: rbac.authorization.k8s.io```:
    - Ye batata hai ki jo ClusterRole hum refer kar rahe hain, wo RBAC API group ka hai.
    - Ye mandatory field hai taaki Kubernetes ko confusion na ho ki hum kis API group ka ClusterRole refer kar rahe hain.
   
<br>
<br>

## apiGroups: [""] ka Kya matlab hai, What are the types of ApiGroups

<br>

### Kubernetes ke andar API ka role kya hai?

Sabse pehle base samajh lete hain:
- Kubernetes ek control plane driven system hai.
- Iska matlab hai ki tum jab bhi ```kubectl``` se koi command chalate ho (jaise ```kubectl get pods```), ya phir koi client program API ko call karta hai, wo ```kube-apiserver``` ke paas request bhejta hai.
- ```kube-apiserver``` hi wo component hai jo tumhari request ko authenticate, authorize aur validate karke cluster ke resources ko manage karta hai.

Matlab Kubernetes me har ek kaam API ke through hota hai. Tum manually Pod create kar rahe ho ya phir automation tool (jaise Helm, ArgoCD, Terraform) use kar rahe ho — sab kuch API ke endpoints ko hit kar raha hai.

<br>

### Problem Statement: API ko kaise organize kare?

- Jab Kubernetes bana tha, tab bahut hi limited resources hote the (sirf Pods, Services, ConfigMaps, Secrets, Namespaces).
- Sabhi resources ek hi API endpoint ke andar the: ```/api/v1```.
- Lekin jaise jaise naye resources add hote gaye (Deployments, ReplicaSets, Jobs, CronJobs, RBAC roles, NetworkPolicies, Ingress, etc.), sabko ek hi jagah rakhna impossible ho gaya.

Socho agar tumhare paas 100 alag resources hain aur sab ek hi endpoint /api/v1 ke andar ghuus rahe hain — toh ye ek dum messy aur unmanageable system ban jaata.

Isliye ek logical structure banane ke liye API Groups ka concept introduce kiya gaya.

<br>

### API Groups kya hote hain?

Kubernetes ke andar har ek API object (jaise Pod, Deployment, Node, Secret, Job, Ingress, etc.) ek REST API ke endpoint ke through represent hota hai.

API Group ek tarah ka logical category / namespace for resources hai.
- Ye ek string hoti hai (jaise ```apps```, ```batch```, ```rbac.authorization.k8s.io```).
- Har ek resource ek specific API group ke andar aata hai.
- Har group ke andar ek ya multiple versions hote hain (```v1```, ```v1beta1```, etc.).

Full path of a resource looks like this:
```
/apis/<apiGroup>/<version>/<resource>
```

Example:
- Pod → ```/api/v1/pods``` (core group).
- Deployment → ```/apis/apps/v1/deployments```.
- Job → ```/apis/batch/v1/jobs```.
- Role → ```/apis/rbac.authorization.k8s.io/v1/roles```.

<br>
<br>

### Kubernetes ke major API Groups / Types of API Groups

Kubernetes ke andar mainly 3 tarah ke API groups hote hain:
- Core API Group (ya legacy group).
- Named API Groups.
- Custom API Groups.

<br>

**1 - Core Group (Legacy Group)**:
- Ye Kubernetes ka sabse purana aur default group hai.
- Iska naam technically blank string (```""```) hota hai.
- Isme basic aur fundamental resources hote hain jo bina Kubernetes ke sochi nahi ja sakti.

Common resources in Core API group:
- Pods.
- Services.
- ConfigMaps.
- Secrets.
- PersistentVolumes (PV).
- PersistentVolumeClaims (PVC).
- Namespaces.
- Nodes.
- Endpoints.

Path:
```
/api/v1/pods
/api/v1/services
```

RBAC Example for Pods:
```
rules:
- apiGroups: [""]
  resources: ["pods"]
  verbs: ["get", "list", "watch"]
```

Yahan ```apiGroups: [""]``` likhna padega, warna Kubernetes samjhega hi nahi ki Pods kis group me hain.

<br>

**2 - Named API Groups**:

- Ye naye resources ke liye banaye gaye jo baad me Kubernetes me introduce hue.
- Inke naam ek clear string hote hain.

Examples of Named Groups:

| API Group                   | Resources Example                                      |
| --------------------------- | ------------------------------------------------------ |
| `apps`                      | Deployments, StatefulSets, DaemonSets, ReplicaSets     |
| `batch`                     | Jobs, CronJobs                                         |
| `rbac.authorization.k8s.io` | Roles, ClusterRoles, RoleBindings, ClusterRoleBindings |
| `networking.k8s.io`         | Ingress, NetworkPolicies                               |
| `autoscaling`               | HorizontalPodAutoscalers                               |
| `apiextensions.k8s.io`      | CustomResourceDefinitions (CRDs)                       |
| `policy` (deprecated)       | PodSecurityPolicies                                    |

Path examples:
- Deployment: ```/apis/apps/v1/deployments```.
- Job: ```/apis/batch/v1/jobs```.
- Role: ```/apis/rbac.authorization.k8s.io/v1/roles```.

RBAC Example for Deployments:
```
rules:
- apiGroups: ["apps"]
  resources: ["deployments"]
  verbs: ["create", "get", "list", "delete"]
```

<br>

**3 - Custom API Groups (CRDs)**:

- Ye user-defined groups hote hain jo tum khud bana sakte ho CustomResourceDefinition (CRD) ke through.
- CRD se tum Kubernetes ko extend kar sakte ho apne custom resources ke saath.

Example: Database CRD
```
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: databases.example.com
spec:
  group: example.com
  names:
    kind: Database
    plural: databases
  scope: Namespaced
  versions:
  - name: v1
    served: true
    storage: true
```

Ab ye resource ```/apis/example.com/v1/databases``` par available hoga.

RBAC Example:
```
rules:
- apiGroups: ["example.com"]
  resources: ["databases"]
  verbs: ["get", "create", "delete"]
```

<br>

### API Groups ke andar Versions ka Role
- Har API group ke andar ek ya multiple versions hote hain.
- Versions compatibility ke liye banaye jaate hain.

Types of versions:
- ```alpha``` → experimental, unstable (production ke liye recommended nahi).
- ```beta``` → testing phase me hai, lekin kaafi stable.
- ```v1```, ```v2```, ... → stable release.

Example:
- Deployment (pehle ```extensions/v1beta1``` me tha, ab ```apps/v1``` me shift ho gaya).
- CronJob (pehle ```batch/v1beta1``` me tha, ab ```batch/v1``` me aa gaya).

Matlab jab Kubernetes evolve hota hai, resources ek group-version se doosre me migrate ho jaate hain.

<br>

### API Groups and RBAC Together

RBAC (Role-Based Access Control) me apiGroups field mandatory hai.
- Kyunki ek hi naam ke resources alag groups me ho sakte hain.
- Example: Pehle Deployments ```extensions/v1beta1``` group me the, ab ```apps/v1``` me hain. Agar tum galat group likh doge to rule apply hi nahi hoga.

Example RBAC Role:
```
rules:
- apiGroups: [""]
  resources: ["pods"]
  verbs: ["get", "list"]

- apiGroups: ["apps"]
  resources: ["deployments"]
  verbs: ["get", "list", "create", "delete"]

- apiGroups: ["batch"]
  resources: ["jobs", "cronjobs"]
  verbs: ["create", "delete"]
```

**Real World Example: Confusion Case**:

Maan lo tum ek developer ko Deployments par access dena chahte ho. Tumne Role banaya:
```
rules:
- apiGroups: [""]
  resources: ["deployments"]
  verbs: ["get"]
```

Ye kaam hi nahi karega, kyunki Deployments core group me nahi hote. Wo "```apps```" group me hote hain.

Correct version:
```
rules:
- apiGroups: ["apps"]
  resources: ["deployments"]
  verbs: ["get"]
```

Ye ek real world me sabse common confusion hoti hai. Log sochte hain ki Deployment bhi ek “basic resource” hai jaise Pod, lekin actually wo ek higher-level resource hai isliye ```apps``` group ke andar aata hai.

<br>

### | Resource                   | API Group                   | Path Example                                              |
| -------------------------- | --------------------------- | --------------------------------------------------------- |
| Pods, Services, ConfigMaps | `""` (core)                 | `/api/v1/pods`                                            |
| Deployments, StatefulSets  | `apps`                      | `/apis/apps/v1/deployments`                               |
| Jobs, CronJobs             | `batch`                     | `/apis/batch/v1/jobs`                                     |
| Roles, ClusterRoles        | `rbac.authorization.k8s.io` | `/apis/rbac.authorization.k8s.io/v1/roles`                |
| Ingress, NetworkPolicy     | `networking.k8s.io`         | `/apis/networking.k8s.io/v1/ingress`                      |
| HorizontalPodAutoscaler    | `autoscaling`               | `/apis/autoscaling/v1/hpa`                                |
| CRDs                       | `apiextensions.k8s.io`      | `/apis/apiextensions.k8s.io/v1/customresourcedefinitions` |

<br>
<br>
<br>

## Example (LAB): Real-Time Example Scenario

**Scenario**:
- Tumhare paas ek Kubernetes cluster hai (AKS for example).
- Ek developer hai jiska naam Puneet hai.
- Puneet ko production cluster main sirf pods aur deployments read-only access chahiye.
- Matlab vo create / delete / modify kuch bhi nahi kar paaye, sirf dekh paaye.

Ab is use case ko hum step by step implement karenge using RBAC.

<br>
<br>

### Step 1: Authentication ka concept samajhna

Sabse pehle ye samajhna zaruri hai ki Kubernetes main koi bhi user ya system jab access karta hai to do steps hote hain:

- **Authentication** → User ko identify karna (ye kaun hai?).
  
Example: Puneet user ka identity Azure AD se aayi, ya ServiceAccount ke token se, ya kubeconfig certificate se.

- **Authorization** → Ye user cluster main kya kar sakta hai aur kya nahi kar sakta? (RBAC se define hota hai).

Is lab main hum assume karenge ki tumne already user Puneet ke liye authentication manage kar liya hai (maan lo service account ya kubeconfig ke zariye).
Hum yaha sirf Authorization (RBAC) ka part implement karenge.

<br>

### Step 2: Role create karna (Namespace-Scoped Access)

Hum Puneet ko sirf ek specific namespace (maan lo ```dev-team```) main pods aur deployments read karne ka access dena chahte hain.

Example:
```
# role-pod-deploy-reader.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  namespace: dev-team      # Ye role sirf dev-team namespace ke liye valid hai
  name: pod-deploy-reader  # Role ka naam (identifier)
rules:
- apiGroups: [""]          # "" matlab core API group (pods, services, etc.)
  resources: ["pods"]      # Resource jiske liye access chahiye
  verbs: ["get", "list", "watch"]   # Sirf read-only actions allowed hain
- apiGroups: ["apps"]      # apps API group (deployments yaha aate hain)
  resources: ["deployments"]
  verbs: ["get", "list", "watch"]
```

<br>

### Step 3: RoleBinding create karna (Role ko User se jodna)

Ab hume role ko bind karna hoga ek user ke saath. Maan lo user ka naam hai ```puneet``` jo certificate/kubeconfig ya service account se aa raha hai.

Example:
```
# rolebinding-puneet.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: puneet-read-access
  namespace: dev-team
subjects:
- kind: User             # Subject type User hai
  name: puneet           # User ka naam (authentication ke samay aaega)
  apiGroup: rbac.authorization.k8s.io
roleRef:
  kind: Role
  name: pod-deploy-reader   # Jo Role humne banaya tha
  apiGroup: rbac.authorization.k8s.io
```

<br>

### Step 4: User ka Access Test karna

Ab maan lo Puneet ke paas ek kubeconfig file hai (jisme user Puneet define hai). Admin Puneet ko woh file de deta hai.

Jab Puneet ye command chalata hai:
```
kubectl get pods -n dev-team --kubeconfig=puneet-kubeconfig
```
Output:
- Puneet sirf dev-team namespace ke pods dekh paayega.

Agar Puneet ye kare:
```
kubectl delete pod podname -n dev-team --kubeconfig=puneet-kubeconfig
```
Output: Error Ayega
```
Error from server (Forbidden): pods "podname" is forbidden: User "puneet" cannot delete resource "pods" in API group "" in the namespace "dev-team"
```

Ye hi RBAC ka power hai – exact required access aur kuch nahi.

<br>

### Step 5: Real-World Validation

1 - Agar Puneet dusre namespace (jaise ```kube-system```) me pods dekhne ki koshish kare:
```
kubectl get pods -n kube-system --kubeconfig=puneet-kubeconfig
```
Output:
- Error aayega forbidden ka, kyunki uske paas sirf dev-team namespace ke liye RoleBinding tha.

2 - Agar Puneet deployments dekhna chahe:
```
kubectl get deployments -n dev-team --kubeconfig=puneet-kubeconfig
```
Output:
- Ye allow hoga, kyunki role me deployments ke liye read access diya gaya tha.

3 - Agar Puneet services dekhna chahe:
```
kubectl get svc -n dev-team --kubeconfig=puneet-kubeconfig
```
Output:
- Error aayega kyunki services ke liye koi permission role me define nahi ki gayi thi.


