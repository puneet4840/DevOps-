# RBAC in Kubernetes

RBAC -> Role Based Access Control

RBAC ka full form hai: **Role-Based Access Control**.

Iska kaam hai:
- Define karna ki kon (user, group, service account),
- kis resource par (pods, deployments, services, secrets, etc.),
- kya action (verbs: get, list, create, update, delete, watch),
- perform kar sakta hai ya nahi.

RBAC kubernetes ka security mechanism hota hai jo user, group ya service account ko kubernetes ke resources jaise pods, deployment, services, etc par permission provide karta hai. Permission ka matlab hai kya user, group ya service account kubernetes ke resources ko access kar sakta hai ya nhi.

<br>

### RBAC Kubernetes main kab use hota hai.

Kubernetes main jab user ya service account, kubernetes ke kisi bhi resource ko access karte hain to Api Server ko request send karte hain, Api Server ke paas request aane ke baad Api Server 3 task perform karta hai, Jaise:
- Authentication.
- Authorization.
- Validation.

Ye jo Authorization part hota hai, Yha pe RBAC ka part aata hai. Is Authorization task main Api Server RBAC ke through jo request Api Server par aayi hai uski permission check karta hai.

<br>

### RBAC ki zaroorat kyon padi?

Kubernetes ek multi-user system hai. Matlab cluster me ek hi time par multiple log (admins, developers, testers, CI/CD pipelines, monitoring tools) kaam kar rahe hote hain.

Agar hum sochen ki har kisi ko cluster-admin access de diya jaye to:
- Developer galti se ```kubectl delete pod --all -n production``` chala de → ```production crash```.
- Intern sirf pod dekhna chahata tha, par uske paas delete karne ka bhi access hai → ```risk```.
- Jenkins pipeline ko sirf apne namespace me deploy karna hai, par uske paas secrets dekhne ka bhi access aa gaya → ```security issue```.
- Company me compliance requirements hoti hain (ISO, SOC2, HIPAA) jo kehti hain ki ```“least privilege principle”``` follow karo → har user ko sirf utna access do jitna zaroori hai.

Isliye Kubernetes ne ek authorization mechanism banaya jisme tum define kar sako:
- Kaun (Subject: User, Group, ServiceAccount).
- Kis resource pe (pods, deployments, nodes, secrets, namespaces, PVs).
- Kaunsa action kar sakta hai (get, list, watch, create, update, delete, patch, exec)

Aur isi ka naam hai RBAC (Role-Based Access Control).

<br>

### Authorization ke Liye RBAC kyu aaya?

Pehle Kubernetes mein access control ke liye basic ABAC (Attribute-Based Access Control) hota tha jisme ek JSON policy file hoti thi jisme likha hota tha ki kaun kya kar sakta hai matlab kisko kya permission hai.

Problem:
- Har baar JSON file edit karni padti thi.
- Dynamic changes possible nahi the.
- Large clusters mein bahut complex ho jata tha.

Isliye Kubernetes ne introduce kiya: **RBAC (Role-Based Access Control)**.

<br>

### RBAC ka Concept

RBAC ka concept simple hai:
- Instead of directly binding permissions to users,groups or service accounts, tum permissions ko roles mein define karte ho. Fir users ya groups ko roles assign karte ho.
- Pehle tum ek role create karoge.
- Fir us role ko user, groups ya service account se bind karne ke liye ek role binding create karoge.
- RoleBinding se role main jo defined permissions hongi vo user, group ya service account ko attach ho jayengi.

Matlab ek 4 step ka system hai:
- **User / ServiceAccount** (koi entity jo cluster use karna chahti hai).\
- **Role** ya **ClusterRole** (ek permission set jo allow karta hai ki kya actions perform kar sakte ho).
- **RoleBinding** ya **ClusterRoleBinding** (ek mapping jo user ko ek role ke sath jodta hai).
- **Kubernetes API Server** (ye har request pe check karega ki user ke paas wo permission hai ya nahi).

<br>

### Components in RBAC

RBAC main 4 components hote hain:

**Role**:
- Role ek permission set hota hai jo sirf particular namespace main permission provide karta hai.
- Iska matlab ki role user, service account ko sirf ek namesapce main hi permission provide karega. Agar sabhi namespace main permission deni hai to ClusterRole create karna padta hai.

Example: Ek role jo sirf ```pods``` aur ```deployments``` read karne ki permission deta hai.
```
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  namespace: dev-team
  name: pod-reader
rules:
- apiGroups: [""] # "" = core API group
  resources: ["pods", "deployments"]
  verbs: ["get", "list", "watch"]
```

Explanation of Role:
- ```apiVersion: rbac.authorization.k8s.io/v1```:
  - ```rbac.authorization.k8s.io``` = RBAC related resources ke liye Kubernetes ka API group.
  - ```v1``` = stable version hai.

- ```kind: Role```:
  - ```kind``` hamesha batata hai ki tum kis type ka resource bana rahe ho.
  - Yaha ```Role``` likhne ka matlab hai ki tum ek namespace-scoped RBAC role bana rahe ho.
 
- ```metadata```:
  - Har Kubernetes object ke sath ek ```metadata``` section hota hai jisme naam, namespace, labels, annotations define hote hain.
  - Ek tarah se kubernetes object ki detail ko metadeta main likha jata hai jaise ki ye object kya krta hai.
  - ```namespace: dev-team```:
    - Ye role sirf ```dev-team``` namespace ke andar valid hai.
    - Agar Puneet kisi aur namespace mein pod access karega to ye role apply nahi hoga.
  - ```name: pod-reader```:
    - Ye is role ka unique naam hai.
    - Is naam se hum isko RoleBinding ke andar reference karenge.
   
- ```rules```:
  - Ye sabse important section hai — ye define karta hai ki is role ke paas kya-kya permissions hain.
  - Ek role ke andar ek ya multiple ```rules``` blocks ho sakte hain.
  - ```apiGroups: [""]```:
    - Kubernetes APIs different groups mein divided hain.
    - ```""``` (empty string) ka matlab hai core API group jisme pods, services, configmaps jaise resources aate hain.
    - Agar tum "apps" likhte to usme Deployments, DaemonSets aate.
    - Matlab: Ye batata hai ki tum kis API group ke resources pe rules apply kar rahe ho.
  - ```resources: ["pods", "deployments"]```:
    - Iska matlab hai is role ke paas pods aur deployments pe permission milegi.
    - Agar tum yaha ```"*"``` likh dete to iska matlab sabhi resources.
    - Matlab: Ye exact resources specify karta hai jinpe ye role kaam karega.
  - ```verbs: ["get", "list", "watch"]```:
    - Ye actual actions/operations define karta hai jo allow hain.
    - ```get``` → ek resource ki details dekhna.
    - ```list``` → ek saath multiple resources ki list nikalna.
    - ```watch``` → resource ke updates ko continuously dekhna (kubectl describe/logs jaise commands ke liye useful).
    - Agar yaha ```create```, ```delete``` bhi hota to wo aur zyada powerful role hota.
 


<br>

**ClusterRole**:
- ClusterRole ek permission set hai jo cluster wide permission dene ke liye responsible hota hai.
- Iska matlab hai ki ClusterRole user, group, service account ko kubernetes cluster ke ander sabhi resources par sabhi namespace ke ander permission provide karta hai.

Example: Monitoring tools ke liye cluster-wide read access dena.
```
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: cluster-read-all
rules:
- apiGroups: [""]
  resources: ["pods", "services", "nodes"]
  verbs: ["get", "list", "watch"]
```

<br>

**RoleBinding**:
- Humne user ya service account ke liye ek permission set to create kar diya jisko hum role kehte hain, lekin us permission ko particular user ya service account ke saath attach bhi to karna padega, to ye kaam RoleBinding karta hai, RoleBinding user ya service account ko role ke saath attach karta hai jisse user ya service account ko permission mil sake jo tumne role main define ki hai.

- Ye ek user/serviceaccount ko ek Role ke sath bind karta hai ek namespace ke andar.

Example: Binding user puneet with a role 
```
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: read-pods
  namespace: dev-team
subjects:
- kind: User
  name: puneet
  apiGroup: rbac.authorization.k8s.io
roleRef:
  kind: Role
  name: pod-reader
  apiGroup: rbac.authorization.k8s.io
```
- Ab user ```puneet``` ke paas sirf ```dev-team``` namespace mein pods read karne ka access hoga.

<br>

**ClusterRoleBinding**:
- Humne user ya service account ke liye ek permission set to create kar diya jisko hum ClusterRole kehte hain, lekin us permission ko particular user ya service account ke saath attach bhi to karna padega, to ye kaam ClusterRoleBinding karta hai, ClusterRoleBinding user ya service account ko ClusterRole ke saath attach karta hai jisse user ya service account ko permission mil sake jo tumne role main define ki hai.

- Ye ek user/serviceaccount ko ek ClusterRole ke sath bind karta hai poore cluster pe sabhi namespaces main sabhi resources ke liye.

Example:
```
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: cluster-read-access
subjects:
- kind: User
  name: puneet
  apiGroup: rbac.authorization.k8s.io
roleRef:
  kind: ClusterRole
  name: cluster-read-all
  apiGroup: rbac.authorization.k8s.io
```

